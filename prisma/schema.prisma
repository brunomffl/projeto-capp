generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Papel {
  admin
  professor
  aluno
}

model Usuario {
  id           String     @id @default(uuid())
  firebase_uid String     @unique
  email        String     @unique
  papel        Papel
  professor    Professor?
}

model Professor {
  id           String    @id @default(uuid())
  usuario_id   String    @unique
  nome         String
  cpf          String? // opcional
  data_criacao DateTime  @default(now())
  usuario      Usuario   @relation(fields: [usuario_id], references: [id])
  oficinas     Oficina[]
}

model Aluno {
  id              String             @id @default(uuid())
  oficina_id      String
  nome            String
  data_nascimento DateTime
  ativo           Boolean            @default(true)
  oficina         Oficina            @relation(fields: [oficina_id], references: [id])
  frequencias     Frequencia[]
  presencas       Presenca[]
  pareceres       Parecer[]
  historico       HistoricoOficina[]
}

model Oficina {
  id          String   @id @default(uuid())
  titulo      String
  descricao   String
  instrutorId String
  dataInicio  DateTime
  dataFim     DateTime
  capacidade  Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  instrutor Professor          @relation(fields: [instrutorId], references: [id])
  alunos    Aluno[]
  aulas     Aula[]
  historico HistoricoOficina[]
}

model Frequencia {
  id       String   @id @default(uuid())
  aluno_id String
  data     DateTime
  presente Boolean
  aluno    Aluno    @relation(fields: [aluno_id], references: [id])
}

model Parecer {
  id               String        @id @default(uuid())
  aluno_id         String
  texto_parecer    String
  ano              Int
  status           StatusParecer @default(RASCUNHO)
  google_doc_id    String?
  google_doc_url   String?
  data_criacao     DateTime      @default(now())
  data_atualizacao DateTime      @updatedAt
  data_publicacao  DateTime?
  aluno            Aluno         @relation(fields: [aluno_id], references: [id])

  @@unique([aluno_id, ano])
  @@map("pareceres")
}

enum StatusParecer {
  RASCUNHO
  PUBLICADO
  FINALIZADO
}

model HistoricoOficina {
  id           String    @id @default(uuid())
  aluno_id     String
  oficina_id   String
  data_entrada DateTime
  data_saida   DateTime?
  aluno        Aluno     @relation(fields: [aluno_id], references: [id])
  oficina      Oficina   @relation(fields: [oficina_id], references: [id])
}

model Aula {
  id         String   @id @default(uuid())
  oficina_id String
  titulo     String
  descricao  String?
  data       DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  oficina   Oficina    @relation(fields: [oficina_id], references: [id])
  presencas Presenca[]

  @@map("aulas")
}

model Presenca {
  id         String         @id @default(uuid())
  aula_id    String
  aluno_id   String
  status     StatusPresenca @default(AUSENTE)
  created_at DateTime       @default(now())
  updated_at DateTime       @updatedAt

  aula  Aula  @relation(fields: [aula_id], references: [id])
  aluno Aluno @relation(fields: [aluno_id], references: [id])

  @@unique([aula_id, aluno_id])
  @@map("presencas")
}

enum StatusPresenca {
  PRESENTE
  AUSENTE
  JUSTIFICADA
}
